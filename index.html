<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MateTap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(180deg, #0f2027, #203a43, #2c5364);
      color: white;
      text-align: center;
    }

    h1 {
      font-size: 50px;
      margin-top: 20px;
    }

    #mate {
      width: 200px;
      transition: transform 0.1s;
    }

    #mate:active {
      transform: scale(1.2);
    }

    #leaderboard {
      margin-top: 30px;
      background: rgba(255,255,255,0.1);
      padding: 15px;
      border-radius: 10px;
    }

    .player {
      display: flex;
      justify-content: space-between;
      margin: 5px 0;
    }
  </style>
</head>

<body>

<h1 id="points">0</h1>
<img id="mate" src="https://i.imgur.com/7QF5Y6H.png">

<div id="leaderboard">
  <h2>üèÜ Ranking</h2>
  <div id="rankingList"></div>
</div>

<script>
  const mate = document.getElementById("mate");
  const pointsText = document.getElementById("points");
  const rankingList = document.getElementById("rankingList");

  let points = localStorage.getItem("points") || 0;
  pointsText.innerText = points;

  Telegram.WebApp.ready();

  mate.addEventListener("click", function() {
    points++;
    pointsText.innerText = points;
    localStorage.setItem("points", points);
  });

  async function loadRanking() {
    const snapshot = await window.getRanking();
    rankingList.innerHTML = "";

    snapshot.forEach(doc => {
      const data = doc.data();
      rankingList.innerHTML += `
        <div class="player">
          <span>${data.name}</span>
          <span>${data.score}</span>
        </div>
      `;
    });
  }

  setInterval(() => {
    saveScore("Marco", parseInt(points));
    loadRanking();
  }, 5000);
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB76iQtr2i3hG6TIgIpdn3W6rdaxMK9wFQ",
    authDomain: "matetap-e96c3.firebaseapp.com",
    projectId: "matetap-e96c3",
    storageBucket: "matetap-e96c3.firebasestorage.app",
    messagingSenderId: "894538866852",
    appId: "1:894538866852:web:ac59889ebf0ec4d0bf0631"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.saveScore = async function(name, score) {
    await addDoc(collection(db, "leaderboard"), {
      name,
      score,
      createdAt: Date.now()
    });
  };

  window.getRanking = async function() {
    const q = query(
      collection(db, "leaderboard"),
      orderBy("score", "desc"),
      limit(10)
    );
    return await getDocs(q);
  };
</script>

</body>
</html>
