<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MateTap PRO MAX ğŸ§‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {margin:0;font-family:Arial,sans-serif;text-align:center;background: radial-gradient(circle at top,#0f172a,#1e293b);color:white;overflow:hidden;}
h1,h2,h3{margin:10px;text-shadow:0 0 15px #22c55e;}
#mate {width:180px;margin-top:30px;cursor:pointer;transition: transform 0.1s;}
#mate:active {transform: scale(1.2) rotate(-10deg);}
#ranking {margin:20px auto;background: rgba(255,255,255,0.1);padding:15px;border-radius:10px;max-width:350px;}
.player {display:flex;justify-content:space-between;margin:5px 0;}
.floating {position:absolute;font-weight:bold;font-size:20px;animation: floatUp 1s ease-out forwards;}
@keyframes floatUp {0% {opacity:1; transform: translateY(0) scale(1);}50% {transform: translateY(-40px) scale(1.2);}100% {opacity:0; transform: translateY(-80px) scale(1);}}
#skinsMenu button {padding:5px 10px;border:none;border-radius:5px;cursor:pointer;background:rgba(255,255,255,0.2);color:white;margin:3px;}
#skinsMenu button:disabled {opacity:0.5;cursor:not-allowed;}
.powerup {position:absolute;font-size:30px;cursor:pointer;animation: floatUp 1.2s ease-out forwards;}
.badge {position:absolute;font-size:25px;font-weight:bold;color:gold;animation: floatUp 2s ease-out forwards;}
</style>
</head>

<body>

<h1 id="points">0 ğŸ§‰</h1>
<img id="mate" src="https://i.imgur.com/7QF5Y6H.png">
<audio id="clickSound" src="https://assets.mixkit.co/sfx/preview/mixkit-game-click-1114.mp3"></audio>
<audio id="levelSound" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.wav"></audio>
<audio id="powerupSound" src="https://assets.mixkit.co/sfx/preview/mixkit-magic-chime-2.mp3"></audio>

<div id="ranking">
  <h2>ğŸ† Top 10 Ranking</h2>
  <div id="rankingList"></div>
</div>

<h3>ğŸ’° Monedas: <span id="coins">0</span></h3>
<h3>ğŸ¨ Skins</h3>
<div id="skinsMenu"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ğŸ”¹ Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyB76iQtr2i3hG6TIgIpdn3W6rdaxMK9wFQ",
  authDomain: "matetap-e96c3.firebaseapp.com",
  projectId: "matetap-e96c3",
  storageBucket: "matetap-e96c3.firebasestorage.app",
  messagingSenderId: "894538866852",
  appId: "1:894538866852:web:ac59889ebf0ec4d0bf0631"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

Telegram.WebApp.ready();

// ğŸ”¹ DOM Elements
const mate=document.getElementById("mate");
const pointsText=document.getElementById("points");
const coinsText=document.getElementById("coins");
const rankingList=document.getElementById("rankingList");
const skinsMenu=document.getElementById("skinsMenu");
const clickSound=document.getElementById("clickSound");
const levelSound=document.getElementById("levelSound");
const powerupSound=document.getElementById("powerupSound");

// ğŸ”¹ User
const username=Telegram.WebApp.initDataUnsafe.user?.username || "Anon";

// ğŸ”¹ Skins
const skins=[
  {name:"Default", src:"https://i.imgur.com/7QF5Y6H.png", cost:0},
  {name:"Fuego", src:"https://i.imgur.com/f9a1XQm.png", cost:20},
  {name:"Hielo", src:"https://i.imgur.com/J8l5P4u.png", cost:50}
];
let unlocked=JSON.parse(localStorage.getItem("skinsUnlocked")||'["Default"]');
let activeSkin=localStorage.getItem("activeSkin")||"Default";

// ğŸ”¹ State
let points=0, coins=0;

// ğŸ”¹ Load user data
async function loadUser(){
  const userDoc=doc(db,"users",username);
  const snapshot=await getDoc(userDoc);
  if(snapshot.exists()){
    const data=snapshot.data();
    points=data.points||0;
    coins=data.coins||0;
    unlocked=data.unlocked||unlocked;
    activeSkin=data.activeSkin||activeSkin;
  }
  pointsText.innerText=points+" ğŸ§‰";
  coinsText.innerText=coins;
  mate.src=skins.find(s=>s.name===activeSkin).src;
  updateSkinsMenu();
}

// ğŸ”¹ Save user
async function saveUser(){
  const userDoc=doc(db,"users",username);
  await setDoc(userDoc,{points,coins,unlocked,activeSkin,updatedAt:Date.now()});
}

// ğŸ”¹ Skins menu
function updateSkinsMenu(){
  skinsMenu.innerHTML="";
  skins.forEach(skin=>{
    const btn=document.createElement("button");
    btn.innerText=skin.name+(unlocked.includes(skin.name)?" âœ…":" ğŸ’°"+skin.cost);
    btn.disabled=!unlocked.includes(skin.name) && coins<skin.cost;
    btn.onclick=()=>{
      if(!unlocked.includes(skin.name)){
        if(coins>=skin.cost){coins-=skin.cost; unlocked.push(skin.name);}
        else{alert("No tienes suficientes monedas ğŸ’°");return;}
      }
      activeSkin=skin.name;
      mate.src=skin.src;
      localStorage.setItem("activeSkin",activeSkin);
      localStorage.setItem("skinsUnlocked",JSON.stringify(unlocked));
      updateSkinsMenu();
      saveUser();
    };
    skinsMenu.appendChild(btn);
  });
}

// ğŸ”¹ Floating effects
function spawnFloating(e){
  const plus=document.createElement("div");
  plus.classList.add("floating");
  if(activeSkin==="Fuego"){plus.innerText="ğŸ”¥+1ğŸ”¥"; plus.style.color="orange";}
  else if(activeSkin==="Hielo"){plus.innerText="â„ï¸+1â„ï¸"; plus.style.color="cyan";}
  else{plus.innerText="+1 ğŸ§‰"; plus.style.color="#22c55e";}
  const offsetX=Math.random()*40-20;
  const offsetY=Math.random()*40-20;
  plus.style.left=(e.pageX+offsetX)+"px";
  plus.style.top=(e.pageY+offsetY)+"px";
  plus.style.fontSize=(18+Math.random()*12)+"px";
  plus.style.transform=`rotate(${Math.random()*360}deg)`;
  document.body.appendChild(plus);
  setTimeout(()=>plus.remove(),1200);

  if(activeSkin==="Fuego"||activeSkin==="Hielo"){
    for(let i=0;i<5;i++){
      const p=document.createElement("div");
      p.classList.add("floating");
      p.innerText=activeSkin==="Fuego"?"ğŸ”¥":"â„ï¸";
      p.style.left=(e.pageX+Math.random()*60-30)+"px";
      p.style.top=(e.pageY+Math.random()*60-30)+"px";
      p.style.fontSize=(10+Math.random()*15)+"px";
      p.style.color=activeSkin==="Fuego"?"orange":"cyan";
      document.body.appendChild(p);
      setTimeout(()=>p.remove(),1000+Math.random()*500);
    }
  }
}

// ğŸ”¹ Level up
function getLevel(p){return Math.floor(Math.sqrt(p/10))+1;}
function showLevelUp(level){
  const lev=document.createElement("div");
  lev.classList.add("floating");
  lev.innerText=`âœ¨ Level ${level} âœ¨`;
  lev.style.left="50%"; lev.style.top="50%"; lev.style.transform="translate(-50%,-50%)";
  document.body.appendChild(lev);
  levelSound.currentTime=0; levelSound.play();
  setTimeout(()=>lev.remove(),2000);
}

// ğŸ”¹ Power-ups
function spawnPowerup(){
  const pu=document.createElement("div");
  pu.classList.add("powerup");
  pu.innerText="ğŸ’";
  pu.style.left=Math.random()*window.innerWidth+"px";
  pu.style.top=Math.random()*window.innerHeight+"px";
  document.body.appendChild(pu);
  pu.onclick=()=>{
    points+=5; coins+=2;
    pointsText.innerText=points+" ğŸ§‰"; coinsText.innerText=coins;
    powerupSound.currentTime=0; powerupSound.play();
    pu.remove(); saveUser();
  };
  setTimeout(()=>{if(document.body.contains(pu)) pu.remove();},5000);
}
setInterval(spawnPowerup,10000);

// ğŸ”¹ Click
mate.addEventListener("click",(e)=>{
  points++; pointsText.innerText=points+" ğŸ§‰";
  if(points%10===0){coins++; coinsText.innerText=coins;}
  clickSound.currentTime=0; clickSound.play();
  spawnFloating(e);
  const level=getLevel(points);
  if(level>getLevel(points-1)) showLevelUp(level);
  saveUser();
});

// ğŸ”¹ Ranking
async function loadRanking(){
  const q=query(collection(db,"leaderboard"),orderBy("score","desc"),limit(10));
  const snapshot=await getDocs(q);
  rankingList.innerHTML="";
  snapshot.forEach(doc=>{
    const data=doc.data();
    rankingList.innerHTML+=`<div class="player"><span>${data.name}</span><span>${data.score} ğŸ§‰</span></div>`;
  });
}

// ğŸ”¹ Leaderboard auto-save
async function saveScore(){
  await addDoc(collection(db,"leaderboard"),{name:username,score:points,coins,createdAt:Date.now()});
  loadRanking();
}
loadUser(); loadRanking();
setInterval(saveScore,15000);
</script>

</body>
</html>
